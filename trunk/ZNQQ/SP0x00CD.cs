using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ZNQQ
{
    public class SP0x00CD //往外发送消息
    {
        public byte[] bytes = 
        {
             0x02,0x30,0x37,0x00,0xCD,0x5F,0x58
            ,0x07,0x43,0x53,0xA3 //QQ
            ,0x02,0x00,0x00,0x00,0x01
            ,0x01,0x01,0x00,0x00,0x65,0xEF //-
            ,0xA8,0x5A,0x73,0x14,0xA3,0x46,0x70,0x3A,0x40,0xE1
            ,0x3C,0xC7,0xED,0x88,0x4D,0x80,0x58,0xEF,0xEA,0x4C,0xAA,0xC8,0x46,0xAD,0x40,0x0E
            ,0x97,0x67,0x07,0x73,0x20,0x4C,0x2E,0x1E,0x5B,0xA4,0x04,0xB4,0xDA,0xF7,0x3D,0x39
            ,0x2F,0xFE,0x4E,0xE5,0x05,0x77,0xB4,0x34,0x81,0x96,0x6E,0x1A,0x98,0x28,0xB9,0x0D
            ,0x08,0x6B,0xAA,0xCA,0xFD,0xA8,0xF8,0xA5,0x6D,0x91,0xCC,0xE4,0x90,0x63,0x34,0xF6
            ,0x1C,0x38,0xBB,0xBD,0x9F,0x70,0x09,0xF5,0xED,0x3B,0x27,0x91,0x54,0x9F,0x53,0xE4
            ,0x96,0x39,0xCB,0xAD,0x9F,0xFE,0xB4,0xA6,0x39,0x20,0x88,0x52,0xBC,0xA4,0xD8,0x1E
            ,0xFB,0xED,0x7B,0x2D,0xE2,0x0E,0xD6,0x32,0xE9,0x79,0xB1,0xE0,0xAE,0x12,0xC4,0x17
            ,0x5E,0xE1,0x42,0xAC,0xC9,0xFE,0x20,0x24,0xD8,0x66,0x89,0xE4,0x9D,0xC1
            ,0x03
        };
        byte[] data = 
        { 
             0x07,0x43,0x53,0xA3 //发送方QQbytes
            ,0x1B,0x1D,0xC9,0xB1 //接收方QQbytes
            ,0x00,0x00,0x00,0x08,0x00,0x01,0x00,0x04
            ,0x00,0x00,0x00,0x00,0x30,0x37
            ,0x07,0x43,0x53,0xA3
            ,0x1B,0x1D,0xC9,0xB1
            ,0xC1,0x77
            ,0x4F,0x37,0x0F,0xF4,0xC7,0xC1,0xC3,0x0E,0x93,0x94,0x18,0xD6,0x3B,0x0E,0x00,0x0B
            ,0x56,0x13
            ,0x51,0x28,0xA7,0x81 //发消息时间
            ,0x02,0xD6,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00
            ,0x01,0x4D,0x53,0x47,0x00,0x00,0x00,0x00,0x00
            ,0x51,0x28,0xA7,0x81 //发消息时间
            ,0xCE,0x0D,0x2D
            ,0xB6,0x00,0xFF,0x00,0x00,0x0D,0x01,0x86,0x22,0x00,0x0C,0xE5,0xBE,0xAE,0xE8,0xBD
            ,0xAF,0xE9,0x9B,0x85,0xE9,0xBB,0x91,0x00,0x00,0x01,0x00,0x0C,0x01,0x00
            ,0x09
            ,0xE5,0x9C,0xA8,0xE4,0xB8,0x9C,0xE8,0x8E,0x9E //在东莞
        };
        public SP0x00CD()
        { }
        public void PrepareData(byte[] sessionKey, byte[] qqbytes,byte[] qqto,string msg)
        {
            Array.Copy(Tools.Random16Bytes, 0, this.bytes, 5, 2);//相同消息服务器会忽略
            Array.Copy(qqbytes, 0, this.bytes, 7, 4);

            Array.Copy(qqbytes, 0, this.data, 0, 4);
            Array.Copy(qqbytes, 0, this.data, 22, 4);

            byte[] nowbytes = Tools.NowToBytes();
            Array.Copy(qqto, 0, this.data, 4, 4); //目标
            Array.Copy(qqto, 0, this.data, 26, 4);//目标
            Array.Copy(nowbytes, 0, this.data, 50, 4); //时间
            Array.Copy(nowbytes, 0, this.data, 73, 4);//时间

            Array.Copy(new QQCrypt().QQ_Encrypt(data, sessionKey), 0, bytes, 22, new QQCrypt().QQ_Encrypt(data, sessionKey).Length);
        }
    }
}
